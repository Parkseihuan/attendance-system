<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„¸ë¯¸ë‚˜ì‹¤ ì¶œì„ ì²´í¬</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 500px;
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #f9ca24);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .header p {
            color: #7f8c8d;
            font-size: 16px;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .autocomplete-detected {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
        }

        .warning-message, .error-message, .success-message {
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
            display: none;
        }

        .warning-message {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .error-message {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .success-message {
            background-color: #d1edff;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .submit-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .device-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-size: 12px;
            color: #6c757d;
        }

        .timestamp {
            text-align: center;
            color: #7f8c8d;
            font-size: 14px;
            margin-top: 20px;
        }

        .blocked-message {
            text-align: center;
            color: #e74c3c;
            font-size: 18px;
            font-weight: 600;
        }

        .manual-instruction {
            background: #e8f4f8;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }

        .manual-instruction h3 {
            color: #17a2b8;
            margin-bottom: 10px;
        }

        .fingerprint-info {
            font-size: 10px;
            color: #adb5bd;
            margin-top: 10px;
            text-align: center;
        }

        .location-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }

        .location-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(40, 167, 69, 0.3);
        }

        .location-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .location-btn.checking {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
        }

        .location-btn.success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .location-btn.error {
            background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
        }

        .location-info {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }

        .location-result {
            font-size: 14px;
            line-height: 1.5;
        }

        .location-success {
            color: #155724;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .location-error {
            color: #721c24;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .coordinates-info {
            font-size: 12px;
            color: #6c757d;
            margin-top: 8px;
            font-family: monospace;
            background: #f1f3f4;
            padding: 8px;
            border-radius: 4px;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 400px;
            width: 90%;
            transform: translateY(-20px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        .modal-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .modal-message {
            font-size: 16px;
            color: #555;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .modal-close-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-close-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
        
        .modal-icon.success { color: #28a745; }
        .modal-icon.error { color: #dc3545; }
        .modal-icon.warning { color: #ffc107; }

        /* ëª¨ë°”ì¼ ë””ë²„ê·¸ ì •ë³´ í‘œì‹œ */
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 10px;
            margin-top: 15px;
            font-size: 12px;
            color: #6c757d;
            font-family: monospace;
        }

        @media (max-width: 600px) {
            .container {
                padding: 30px 20px;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 24px;
            }

            .debug-info {
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container rounded-xl">
        <div class="header">
            <h1 id="eventTitle">ğŸ“ ì„¸ë¯¸ë‚˜ì‹¤ ì¶œì„ ì²´í¬</h1>
            <p id="eventDescription">í–‰ì‚¬ ì°¸ì„ í™•ì¸ì„ ìœ„í•´ ì •ë³´ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”</p>
        </div>

        <div id="attendanceForm">
            <form id="checkInForm">
                <div class="form-group">
                    <label for="name">ì´ë¦„ *</label>
                    <input type="text" id="name" name="name" required autocomplete="name" class="rounded-lg">
                </div>

                <div class="form-group">
                    <label for="affiliation">ì†Œì† *</label>
                    <input type="text" id="affiliation" name="affiliation" required autocomplete="organization" class="rounded-lg">
                </div>

                <div class="form-group">
                    <label for="email">ì´ë©”ì¼</label>
                    <input type="email" id="email" name="email" autocomplete="email" class="rounded-lg">
                </div>

                <div class="form-group">
                    <label for="phone">ì—°ë½ì²˜</label>
                    <input type="tel" id="phone" name="phone" autocomplete="tel" class="rounded-lg">
                </div>

                <div class="form-group">
                    <label for="location">ìœ„ì¹˜ í™•ì¸ *</label>
                    <div class="location-status" id="locationStatus">
                        <button type="button" class="location-btn rounded-lg" id="locationBtn">
                            ğŸ“ í˜„ì¬ ìœ„ì¹˜ í™•ì¸
                        </button>
                        <div class="location-info rounded-lg" id="locationInfo" style="display: none;">
                            <div class="location-result" id="locationResult"></div>
                        </div>
                    </div>
                    <input type="hidden" id="location" name="location" required>
                    <input type="hidden" id="coordinates" name="coordinates">
                </div>

                <div class="warning-message rounded-lg" id="warningMessage">
                    âš ï¸ ì…ë ¥í•˜ì‹  ì •ë³´ì™€ ë¸Œë¼ìš°ì €ì— ì €ì¥ëœ ì •ë³´ê°€ ë‹¤ë¦…ë‹ˆë‹¤. ì •í™•í•œ ì •ë³´ì¸ì§€ í™•ì¸í•´ ì£¼ì„¸ìš”.
                </div>

                <button type="submit" class="submit-btn rounded-lg" id="submitBtn">ì¶œì„ ì²´í¬ ì™„ë£Œ</button>
            </form>

            <div class="manual-instruction rounded-r-lg" id="manualInstructionBox">
                <h3>ğŸ“± íœ´ëŒ€í° ì‚¬ìš©ì´ ì–´ë ¤ìš°ì‹  ê²½ìš°</h3>
                <p id="manualInstructionText">í–‰ì‚¬ì¥ ì•ìª½ì— ë¹„ì¹˜ëœ <strong>'ì°¸ì„ì ëª…ë¶€'</strong>ì— ì§ì ‘ ê¸°ì¬í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.</p>
            </div>

            <div class="device-info rounded-lg" id="deviceInfo"></div>
            <div class="fingerprint-info">
                ë³´ì•ˆì„ ìœ„í•´ ê¸°ê¸° ì •ë³´ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤ (ì¤‘ë³µ ì²´í¬ ë°©ì§€ìš©)
            </div>

            <!-- ëª¨ë°”ì¼ ë””ë²„ê·¸ ì •ë³´ -->
            <div class="debug-info" id="debugInfo" style="display: none;">
                <div><strong>ì„¤ì • ë¡œë“œ ìƒíƒœ:</strong></div>
                <div id="debugDetails"></div>
                <button type="button" onclick="toggleDebug()" style="margin-top: 5px; padding: 5px 10px; background: #007bff; color: white; border: none; border-radius: 4px; font-size: 10px;">
                    ë””ë²„ê·¸ í† ê¸€
                </button>
            </div>
        </div>

        <div id="blockedMessage" style="display: none;">
            <div class="blocked-message">
                <h2>ğŸš« ì´ë¯¸ ì¶œì„ ì²´í¬ ì™„ë£Œ</h2>
                <p>ì´ ê¸°ê¸°ì—ì„œëŠ” ì´ë¯¸ ì¶œì„ ì²´í¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                <div class="manual-instruction rounded-r-lg" id="blockedManualInstruction">
                    <h3>ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ ì¶œì„ ì²´í¬</h3>
                    <p id="blockedManualInstructionText">í–‰ì‚¬ì¥ ì•ìª½ì— ë¹„ì¹˜ëœ <strong>'ì°¸ì„ì ëª…ë¶€'</strong>ì— ì§ì ‘ ê¸°ì¬í•´ ì£¼ì„¸ìš”.</p>
                </div>
            </div>
        </div>

        <div class="timestamp" id="timestamp"></div>
    </div>

    <!-- Custom Modal for Alerts -->
    <div id="customModal" class="modal-overlay">
        <div class="modal-content rounded-xl">
            <div id="modalIcon" class="modal-icon"></div>
            <h3 id="modalTitle" class="modal-title"></h3>
            <p id="modalMessage" class="modal-message"></p>
            <button id="modalCloseBtn" class="modal-close-btn rounded-lg">í™•ì¸</button>
        </div>
    </div>

    <script>
        // ì „ì—­ ë””ë²„ê·¸ í•¨ìˆ˜
        function toggleDebug() {
            const debugInfo = document.getElementById('debugInfo');
            if (debugInfo.style.display === 'none') {
                debugInfo.style.display = 'block';
                updateDebugInfo();
            } else {
                debugInfo.style.display = 'none';
            }
        }

        function updateDebugInfo() {
            const debugDetails = document.getElementById('debugDetails');
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            let debugText = '';
            debugText += `ëª¨ë°”ì¼: ${isMobile ? 'Yes' : 'No'}<br>`;
            debugText += `User Agent: ${navigator.userAgent.substring(0, 50)}...<br>`;
            debugText += `localStorage í‚¤ ìˆ˜: ${Object.keys(localStorage).length}<br>`;
            
            // ì„¤ì • ê´€ë ¨ í‚¤ í™•ì¸
            const configKeys = [
                'attendanceConfig',
                'eventConfig', 
                'checkConfig',
                'eventTitle',
                'eventDescription',
                'manualInstruction',
                'allowedLocations'
            ];
            
            debugText += '<br><strong>ì„¤ì • í‚¤ ìƒíƒœ:</strong><br>';
            configKeys.forEach(key => {
                const exists = localStorage.getItem(key) !== null;
                debugText += `${key}: ${exists ? 'âœ…' : 'âŒ'}<br>`;
            });
            
            // í˜„ì¬ DOM ìƒíƒœ
            debugText += '<br><strong>í˜„ì¬ DOM ìƒíƒœ:</strong><br>';
            debugText += `ì œëª©: "${document.getElementById('eventTitle').textContent}"<br>`;
            debugText += `ì„¤ëª…: "${document.getElementById('eventDescription').textContent}"<br>`;
            
            debugDetails.innerHTML = debugText;
        }

        // ì´ˆê°•ë ¥ ëª¨ë°”ì¼ ì„¤ì • ë¡œë“œ í•¨ìˆ˜ (ìºì‹œ ë¬´ë ¥í™”)
        function loadAdminSettings() {
            console.log('ğŸ”„ ê´€ë¦¬ì ì„¤ì • ë¡œë“œ ì‹œì‘...');
            console.log('ğŸ“± User Agent:', navigator.userAgent);
            console.log('ğŸ“± Is Mobile:', /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));
            console.log('â° ë¡œë“œ ì‹œê°„:', new Date().toLocaleTimeString());
            
            try {
                // localStorage ì ‘ê·¼ ê°€ëŠ¥ì„± ì²´í¬
                if (typeof(Storage) === "undefined") {
                    console.error('âŒ localStorage ì§€ì›ë˜ì§€ ì•ŠìŒ');
                    return;
                }

                // ëª¨ë“  localStorage í‚¤ ë¡œê·¸
                const allKeys = Object.keys(localStorage);
                console.log('ğŸ“¦ localStorage ì „ì²´ í‚¤:', allKeys);

                // ìºì‹œ ë²„ìŠ¤í„° - í˜„ì¬ ì‹œê°„ì„ ì´ìš©í•´ ê°•ì œë¡œ ìƒˆë¡œìš´ ë°ì´í„° ìš”ì²­
                const cacheBuster = Date.now();
                console.log('ğŸ’¥ ìºì‹œ ë²„ìŠ¤í„°:', cacheBuster);

                // ì—¬ëŸ¬ í‚¤ë¡œ ì„¤ì • í™•ì¸ (ìš°ì„ ìˆœìœ„ ìˆœ)
                const configPriority = [
                    'attendanceConfig',
                    'eventConfig', 
                    'checkConfig'
                ];

                let loadedConfig = null;
                let usedKey = null;
                let rawConfigData = null;

                for (const key of configPriority) {
                    rawConfigData = localStorage.getItem(key);
                    console.log(`ğŸ” ${key} ì›ë³¸ ë°ì´í„°:`, rawConfigData);
                    
                    if (rawConfigData) {
                        try {
                            loadedConfig = JSON.parse(rawConfigData);
                            usedKey = key;
                            console.log(`âœ… ì„¤ì • ë¡œë“œ ì„±ê³µ (í‚¤: ${key}):`, loadedConfig);
                            
                            // ëª¨ë°”ì¼ì—ì„œëŠ” ì¦‰ì‹œ ì ìš©í•˜ê³  ê°•ì œ DOM ì—…ë°ì´íŠ¸
                            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                                console.log('ğŸ“± ëª¨ë°”ì¼ ê°ì§€: ì¦‰ì‹œ ê°•ì œ ì ìš©');
                                forceApplyConfigMobile(loadedConfig);
                            }
                            break;
                        } catch (e) {
                            console.warn(`âš ï¸ ${key} íŒŒì‹± ì˜¤ë¥˜:`, e);
                        }
                    } else {
                        console.log(`âŒ ${key} ì—†ìŒ`);
                    }
                }

                if (loadedConfig && usedKey) {
                    console.log(`ğŸ¯ ì‚¬ìš©ëœ ì„¤ì • í‚¤: ${usedKey}`);
                    applyLoadedConfig(loadedConfig);
                } else {
                    console.log('ğŸ”„ í†µí•© ì„¤ì • ì—†ìŒ, ê°œë³„ í‚¤ í™•ì¸...');
                    loadIndividualSettings();
                }

                // ëª¨ë°”ì¼ì—ì„œ ë‹¤ì¤‘ ì¬ì ìš© (ì‹œê°„ì°¨ ê³µê²©)
                if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                    console.log('ğŸ“± ëª¨ë°”ì¼: ë‹¤ì¤‘ ì¬ì ìš© ìŠ¤ì¼€ì¤„ë§');
                    
                    [50, 100, 200, 500, 1000, 2000].forEach((delay, index) => {
                        setTimeout(() => {
                            console.log(`ğŸ“± ì¬ì ìš© ${index + 1}/6 (${delay}ms)`);
                            forceReapplySettings();
                            bruteForceDOMUpdate();
                        }, delay);
                    });
                }

                console.log('âœ… ê´€ë¦¬ì ì„¤ì • ë¡œë“œ ì™„ë£Œ');
                
            } catch (e) {
                console.error('âŒ ì„¤ì • ë¡œë“œ ì˜¤ë¥˜:', e);
                console.log('ğŸ”„ ê¸°ë³¸ê°’ìœ¼ë¡œ fallback');
            }
        }

        // ëª¨ë°”ì¼ ì „ìš© ê°•ì œ ì„¤ì • ì ìš© í•¨ìˆ˜
        function forceApplyConfigMobile(config) {
            console.log('ğŸ’ª ëª¨ë°”ì¼ ê°•ì œ ì„¤ì • ì ìš©:', config);
            
            // 1. ì œëª© ê°•ì œ ì—…ë°ì´íŠ¸
            if (config.eventTitle) {
                const titleElement = document.getElementById('eventTitle');
                if (titleElement) {
                    console.log(`ğŸ“ ì œëª© ê°•ì œ ë³€ê²½: "${titleElement.textContent}" â†’ "${config.eventTitle}"`);
                    
                    // ì—¬ëŸ¬ ë°©ë²•ìœ¼ë¡œ ë™ì‹œ ì ìš©
                    titleElement.textContent = config.eventTitle;
                    titleElement.innerHTML = config.eventTitle;
                    titleElement.innerText = config.eventTitle;
                    
                    // CSS ê°•ì œ ì—…ë°ì´íŠ¸
                    titleElement.style.display = 'none';
                    titleElement.offsetHeight; // ê°•ì œ ë¦¬í”Œë¡œìš°
                    titleElement.style.display = '';
                    
                    // ë¸Œë¼ìš°ì € íƒ­ ì œëª©ë„ ê°•ì œ ë³€ê²½
                    document.title = config.eventTitle;
                    
                    // ì¶”ê°€: setAttributeë¡œë„ ì‹œë„
                    titleElement.setAttribute('data-title', config.eventTitle);
                }
            }
            
            // 2. ì„¤ëª… ê°•ì œ ì—…ë°ì´íŠ¸
            if (config.eventDescription) {
                const descElement = document.getElementById('eventDescription');
                if (descElement) {
                    console.log(`ğŸ“„ ì„¤ëª… ê°•ì œ ë³€ê²½: "${descElement.textContent}" â†’ "${config.eventDescription}"`);
                    
                    descElement.textContent = config.eventDescription;
                    descElement.innerHTML = config.eventDescription;
                    descElement.innerText = config.eventDescription;
                    
                    descElement.style.display = 'none';
                    descElement.offsetHeight;
                    descElement.style.display = '';
                }
            }
            
            // 3. ìˆ˜ë™ ì•ˆë‚´ë¬¸êµ¬ ê°•ì œ ì—…ë°ì´íŠ¸
            if (config.manualInstruction) {
                ['manualInstructionText', 'blockedManualInstructionText'].forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        console.log(`ğŸ“‹ ${id} ê°•ì œ ë³€ê²½`);
                        element.innerHTML = config.manualInstruction;
                        element.style.display = 'none';
                        element.offsetHeight;
                        element.style.display = '';
                    }
                });
            }
            
            console.log('ğŸ’ª ëª¨ë°”ì¼ ê°•ì œ ì ìš© ì™„ë£Œ');
        }

        // ì‹¤ì‹œê°„ ì§„ë‹¨ ë° ê°•ì œ ìˆ˜ì • í•¨ìˆ˜ (ê°•í™”ëœ ë²„ì „)
        function diagnoseMobileIssue() {
            console.log('ğŸ” ëª¨ë°”ì¼ ë¬¸ì œ ì§„ë‹¨ ì‹œì‘...');
            
            const diagnosis = {
                timestamp: new Date().toLocaleTimeString(),
                localStorage: {},
                domState: {},
                userAgent: navigator.userAgent,
                issues: [],
                fixes: [],
                rawData: {}
            };
            
            // 1. localStorage ì™„ì „ ìŠ¤ìº”
            try {
                // ëª¨ë“  localStorage í‚¤ í™•ì¸
                const allKeys = Object.keys(localStorage);
                diagnosis.rawData.allKeys = allKeys;
                
                // ì£¼ìš” ì„¤ì • í‚¤ë“¤ ì²´í¬
                diagnosis.localStorage.attendanceConfig = localStorage.getItem('attendanceConfig');
                diagnosis.localStorage.eventTitle = localStorage.getItem('eventTitle');
                diagnosis.localStorage.eventDescription = localStorage.getItem('eventDescription');
                diagnosis.localStorage.manualInstruction = localStorage.getItem('manualInstruction');
                diagnosis.localStorage.allowedLocations = localStorage.getItem('allowedLocations');
                diagnosis.localStorage.total_keys = allKeys.length;
                
                // ê´€ë¦¬ì ê´€ë ¨ í‚¤ë“¤ë„ í™•ì¸
                diagnosis.localStorage.attendance_settings = localStorage.getItem('attendance_settings');
                diagnosis.localStorage.eventConfig = localStorage.getItem('eventConfig');
                diagnosis.localStorage.checkConfig = localStorage.getItem('checkConfig');
                
                console.log('ğŸ“¦ localStorage ì™„ì „ ì§„ë‹¨:', diagnosis.localStorage);
                console.log('ğŸ“¦ ëª¨ë“  í‚¤:', allKeys);
                
            } catch (e) {
                diagnosis.issues.push('localStorage ì ‘ê·¼ ë¶ˆê°€: ' + e.message);
                console.error('localStorage ì˜¤ë¥˜:', e);
            }
            
            // 2. DOM ìƒíƒœ ì§„ë‹¨
            try {
                const titleEl = document.getElementById('eventTitle');
                const descEl = document.getElementById('eventDescription');
                const manualEl = document.getElementById('manualInstructionText');
                
                diagnosis.domState.title = titleEl ? titleEl.textContent : 'element_not_found';
                diagnosis.domState.description = descEl ? descEl.textContent : 'element_not_found';
                diagnosis.domState.manual = manualEl ? manualEl.innerHTML : 'element_not_found';
                diagnosis.domState.pageTitle = document.title;
                
                console.log('ğŸ  DOM ìƒíƒœ ì§„ë‹¨:', diagnosis.domState);
            } catch (e) {
                diagnosis.issues.push('DOM ì ‘ê·¼ ë¶ˆê°€: ' + e.message);
                console.error('DOM ì˜¤ë¥˜:', e);
            }
            
            // 3. ë°ì´í„°ê°€ ì „í˜€ ì—†ëŠ” ê²½ìš° í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
            if (!diagnosis.localStorage.attendanceConfig && 
                !diagnosis.localStorage.eventTitle && 
                !diagnosis.localStorage.eventDescription) {
                
                console.log('ğŸ†˜ ì„¤ì • ë°ì´í„°ê°€ ì „í˜€ ì—†ìŒ - í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±');
                
                const testConfig = {
                    eventTitle: 'ğŸ“ í…ŒìŠ¤íŠ¸ ì„¸ë¯¸ë‚˜ (ëª¨ë°”ì¼ ìˆ˜ì •ë¨)',
                    eventDescription: 'ëª¨ë°”ì¼ì—ì„œ ìˆ˜ì •ëœ ì„¤ëª…ì…ë‹ˆë‹¤',
                    manualInstruction: 'ëª¨ë°”ì¼ì—ì„œ <strong>ìˆ˜ë™ìœ¼ë¡œ ì„¤ì •ëœ</strong> ì•ˆë‚´ë¬¸êµ¬ì…ë‹ˆë‹¤.'
                };
                
                // ëª¨ë“  ê°€ëŠ¥í•œ í‚¤ì— ì €ì¥
                localStorage.setItem('attendanceConfig', JSON.stringify(testConfig));
                localStorage.setItem('eventConfig', JSON.stringify(testConfig));
                localStorage.setItem('checkConfig', JSON.stringify(testConfig));
                localStorage.setItem('eventTitle', testConfig.eventTitle);
                localStorage.setItem('eventDescription', testConfig.eventDescription);
                localStorage.setItem('manualInstruction', testConfig.manualInstruction);
                
                diagnosis.fixes.push('í…ŒìŠ¤íŠ¸ ì„¤ì • ë°ì´í„° ìƒì„±');
                console.log('âœ… í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì™„ë£Œ:', testConfig);
            }
            
            // 4. ë¶ˆì¼ì¹˜ ê°ì§€ ë° ê°•ì œ ìˆ˜ì •
            try {
                // ì—¬ëŸ¬ ì†ŒìŠ¤ì—ì„œ ì„¤ì • ì°¾ê¸°
                let config = null;
                let configSource = '';
                
                // ìš°ì„ ìˆœìœ„: attendanceConfig > eventConfig > checkConfig > ê°œë³„ í‚¤ë“¤
                const configKeys = ['attendanceConfig', 'eventConfig', 'checkConfig'];
                
                for (const key of configKeys) {
                    const configData = localStorage.getItem(key);
                    if (configData) {
                        try {
                            config = JSON.parse(configData);
                            configSource = key;
                            console.log(`âœ… ì„¤ì • ë°œê²¬: ${key}`, config);
                            break;
                        } catch (e) {
                            console.warn(`âš ï¸ ${key} íŒŒì‹± ì‹¤íŒ¨:`, e);
                        }
                    }
                }
                
                // ê°œë³„ í‚¤ì—ì„œ ì„¤ì • ì¬êµ¬ì„±
                if (!config) {
                    const title = localStorage.getItem('eventTitle');
                    const desc = localStorage.getItem('eventDescription');
                    const manual = localStorage.getItem('manualInstruction');
                    
                    if (title || desc) {
                        config = {
                            eventTitle: title || 'ì„¤ì • ì—†ìŒ',
                            eventDescription: desc || 'ì„¤ì • ì—†ìŒ',
                            manualInstruction: manual || 'ê¸°ë³¸ ì•ˆë‚´ë¬¸êµ¬'
                        };
                        configSource = 'individual_keys';
                        diagnosis.fixes.push('ê°œë³„ í‚¤ì—ì„œ ì„¤ì • ì¬êµ¬ì„±');
                        console.log('ğŸ”§ ê°œë³„ í‚¤ì—ì„œ ì„¤ì • ì¬êµ¬ì„±:', config);
                    }
                }
                
                if (config) {
                    diagnosis.rawData.foundConfig = config;
                    diagnosis.rawData.configSource = configSource;
                    
                    const titleEl = document.getElementById('eventTitle');
                    const descEl = document.getElementById('eventDescription');
                    
                    // ê°•ì œ ì—…ë°ì´íŠ¸ ì‹¤í–‰ (ë¬´ì¡°ê±´)
                    if (config.eventTitle && titleEl) {
                        console.log(`ğŸ”§ ì œëª© ê°•ì œ ì—…ë°ì´íŠ¸: "${titleEl.textContent}" â†’ "${config.eventTitle}"`);
                        forceUpdateElement(titleEl, config.eventTitle);
                        document.title = config.eventTitle;
                        diagnosis.fixes.push(`ì œëª© ê°•ì œ ìˆ˜ì •: ${config.eventTitle}`);
                    }
                    
                    if (config.eventDescription && descEl) {
                        console.log(`ğŸ”§ ì„¤ëª… ê°•ì œ ì—…ë°ì´íŠ¸: "${descEl.textContent}" â†’ "${config.eventDescription}"`);
                        forceUpdateElement(descEl, config.eventDescription);
                        diagnosis.fixes.push(`ì„¤ëª… ê°•ì œ ìˆ˜ì •: ${config.eventDescription}`);
                    }
                    
                    if (config.manualInstruction) {
                        ['manualInstructionText', 'blockedManualInstructionText'].forEach(id => {
                            const el = document.getElementById(id);
                            if (el) {
                                console.log(`ğŸ”§ ${id} ê°•ì œ ì—…ë°ì´íŠ¸`);
                                forceUpdateElement(el, config.manualInstruction, 'innerHTML');
                                diagnosis.fixes.push(`ìˆ˜ë™ì•ˆë‚´ ê°•ì œ ìˆ˜ì •: ${id}`);
                            }
                        });
                    }
                    
                    // ì‹œê°ì  í”¼ë“œë°± ì¶”ê°€
                    addVisualFeedback();
                    
                } else {
                    diagnosis.issues.push('ì‚¬ìš© ê°€ëŠ¥í•œ ì„¤ì • ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                    console.error('âŒ ì„¤ì • ë°ì´í„°ë¥¼ ì „í˜€ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                }
                
            } catch (e) {
                diagnosis.issues.push('ì„¤ì • ì ìš© ì˜¤ë¥˜: ' + e.message);
                console.error('ì„¤ì • ì ìš© ì˜¤ë¥˜:', e);
            }
            
            // 5. ì§„ë‹¨ ê²°ê³¼ í‘œì‹œ
            showDiagnosisResult(diagnosis);
            
            // 6. ì•Œë¦¼ìœ¼ë¡œë„ ê²°ê³¼ í‘œì‹œ
            const fixCount = diagnosis.fixes.length;
            const issueCount = diagnosis.issues.length;
            
            if (fixCount > 0) {
                showQuickAlert(`âœ… ${fixCount}ê°œ í•­ëª©ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
            } else if (issueCount > 0) {
                showQuickAlert(`âš ï¸ ${issueCount}ê°œ ë¬¸ì œê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤`, 'warning');
            } else {
                showQuickAlert('ğŸ” ì§„ë‹¨ ì™„ë£Œ - ëª¨ë“  ê²ƒì´ ì •ìƒì…ë‹ˆë‹¤', 'info');
            }
            
            return diagnosis;
        }
        
        // ì‹œê°ì  í”¼ë“œë°± í•¨ìˆ˜
        function addVisualFeedback() {
            const elements = ['eventTitle', 'eventDescription'];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    // ê¹œë¹¡ì´ëŠ” íš¨ê³¼
                    element.style.transition = 'background-color 0.3s ease';
                    element.style.backgroundColor = '#ffeb3b';
                    
                    setTimeout(() => {
                        element.style.backgroundColor = '';
                        setTimeout(() => {
                            element.style.transition = '';
                        }, 300);
                    }, 500);
                }
            });
        }
        
        // ë¹ ë¥¸ ì•Œë¦¼ í•¨ìˆ˜
        function showQuickAlert(message, type = 'info') {
            const alert = document.createElement('div');
            alert.innerHTML = message;
            alert.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: ${type === 'success' ? '#28a745' : type === 'warning' ? '#ffc107' : '#007bff'};
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                z-index: 10000;
                font-weight: bold;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                font-size: 14px;
                text-align: center;
                max-width: 80%;
            `;
            
            document.body.appendChild(alert);
            
            setTimeout(() => {
                alert.style.opacity = '0';
                alert.style.transition = 'opacity 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(alert);
                }, 300);
            }, 2000);
        }
        
        // ê°•ë ¥í•œ ìš”ì†Œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function forceUpdateElement(element, content, method = 'textContent') {
            if (!element) return;
            
            // 1. ê¸°ë³¸ ì—…ë°ì´íŠ¸
            element[method] = content;
            
            // 2. ëª¨ë“  ê°€ëŠ¥í•œ ë°©ë²•ìœ¼ë¡œ ì—…ë°ì´íŠ¸
            if (method === 'textContent') {
                element.textContent = content;
                element.innerText = content;
                element.innerHTML = content;
            } else if (method === 'innerHTML') {
                element.innerHTML = content;
            }
            
            // 3. ìŠ¤íƒ€ì¼ ê°•ì œ ë³€ê²½ìœ¼ë¡œ ë¦¬ë Œë”ë§ íŠ¸ë¦¬ê±°
            const originalDisplay = element.style.display;
            const originalVisibility = element.style.visibility;
            
            element.style.display = 'none';
            element.style.visibility = 'hidden';
            element.offsetHeight; // ê°•ì œ ë¦¬í”Œë¡œìš°
            
            element.style.display = originalDisplay || '';
            element.style.visibility = originalVisibility || '';
            element.offsetHeight; // ë˜ ë‹¤ë¥¸ ê°•ì œ ë¦¬í”Œë¡œìš°
            
            // 4. í´ë˜ìŠ¤ ì¡°ì‘ìœ¼ë¡œ CSS ì¬ê³„ì‚° ê°•ì œ
            const tempClass = 'force-update-' + Date.now();
            element.classList.add(tempClass);
            setTimeout(() => element.classList.remove(tempClass), 1);
            
            console.log(`ğŸ’ª ê°•ë ¥ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${element.id} â†’ "${content}"`);
        }
        
        // ì§„ë‹¨ ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
        function showDiagnosisResult(diagnosis) {
            const debugDetails = document.getElementById('debugDetails');
            if (!debugDetails) return;
            
            let html = `<div style="font-size: 10px; line-height: 1.3;">`;
            html += `<strong>ğŸ” ì§„ë‹¨ ì‹œê°„:</strong> ${diagnosis.timestamp}<br>`;
            html += `<strong>ğŸ“± ëª¨ë°”ì¼:</strong> ${/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ? 'Yes' : 'No'}<br><br>`;
            
            html += `<strong>ğŸ“¦ localStorage:</strong><br>`;
            html += `â€¢ attendanceConfig: ${diagnosis.localStorage.attendanceConfig ? 'âœ…' : 'âŒ'}<br>`;
            html += `â€¢ eventTitle: ${diagnosis.localStorage.eventTitle ? 'âœ…' : 'âŒ'}<br>`;
            html += `â€¢ eventDescription: ${diagnosis.localStorage.eventDescription ? 'âœ…' : 'âŒ'}<br>`;
            html += `â€¢ ì´ í‚¤ ìˆ˜: ${diagnosis.localStorage.total_keys}<br><br>`;
            
            html += `<strong>ğŸ  í˜„ì¬ DOM:</strong><br>`;
            html += `â€¢ ì œëª©: "${diagnosis.domState.title}"<br>`;
            html += `â€¢ ì„¤ëª…: "${diagnosis.domState.description}"<br><br>`;
            
            if (diagnosis.issues.length > 0) {
                html += `<strong>âš ï¸ ë°œê²¬ëœ ë¬¸ì œ:</strong><br>`;
                diagnosis.issues.forEach(issue => html += `â€¢ ${issue}<br>`);
                html += `<br>`;
            }
            
            if (diagnosis.fixes.length > 0) {
                html += `<strong>ğŸ”§ ì ìš©ëœ ìˆ˜ì •:</strong><br>`;
                diagnosis.fixes.forEach(fix => html += `â€¢ ${fix}<br>`);
                html += `<br>`;
            }
            
            html += `</div>`;
            
            debugDetails.innerHTML = html;
            
            // ë””ë²„ê·¸ íŒ¨ë„ ìë™ í‘œì‹œ
            document.getElementById('debugInfo').style.display = 'block';
        }
        
        // ë¸Œë£¨íŠ¸ í¬ìŠ¤ DOM ì—…ë°ì´íŠ¸ (ìµœí›„ì˜ ìˆ˜ë‹¨)
        function bruteForceDOMUpdate() {
            console.log('ğŸ’¥ ë¸Œë£¨íŠ¸ í¬ìŠ¤ DOM ì—…ë°ì´íŠ¸ ì‹¤í–‰');
            
            // ëª¨ë“  í…ìŠ¤íŠ¸ ìš”ì†Œë¥¼ ê°•ì œë¡œ ë‹¤ì‹œ ë Œë”ë§
            const textElements = ['eventTitle', 'eventDescription', 'manualInstructionText', 'blockedManualInstructionText'];
            
            textElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    const currentContent = element.textContent || element.innerHTML;
                    
                    // ì„ì‹œë¡œ ë‹¤ë¥¸ ë‚´ìš©ìœ¼ë¡œ ë³€ê²½ í›„ ì›ë˜ëŒ€ë¡œ ë³µêµ¬ (ê°•ì œ ë¦¬í”Œë¡œìš°)
                    element.innerHTML = '';
                    element.style.opacity = '0';
                    element.offsetHeight; // ê°•ì œ ë¦¬í”Œë¡œìš°
                    
                    element.innerHTML = currentContent;
                    element.style.opacity = '1';
                    element.offsetHeight; // ë˜ ë‹¤ë¥¸ ê°•ì œ ë¦¬í”Œë¡œìš°
                    
                    console.log(`ğŸ’¥ ${id} ë¸Œë£¨íŠ¸í¬ìŠ¤ ì—…ë°ì´íŠ¸ ì™„ë£Œ`);
                }
            });
            
            // ì „ì²´ bodyë„ í•œë²ˆ ê±´ë“œë ¤ì£¼ê¸°
            document.body.style.transform = 'translateZ(0)';
            setTimeout(() => {
                document.body.style.transform = '';
            }, 1);
        }

        function applyLoadedConfig(settings) {
            console.log('ğŸ¨ ì„¤ì • ì ìš© ì‹œì‘:', settings);
            
            // ì œëª© ì—…ë°ì´íŠ¸
            if (settings.eventTitle) {
                updateElement('eventTitle', settings.eventTitle, 'textContent');
                document.title = settings.eventTitle; // ë¸Œë¼ìš°ì € íƒ­ ì œëª©ë„ ë³€ê²½
                console.log('ğŸ“ ì œëª© ì—…ë°ì´íŠ¸:', settings.eventTitle);
            }
            
            // ì„¤ëª… ì—…ë°ì´íŠ¸
            if (settings.eventDescription) {
                updateElement('eventDescription', settings.eventDescription, 'textContent');
                console.log('ğŸ“„ ì„¤ëª… ì—…ë°ì´íŠ¸:', settings.eventDescription);
            }
            
            // ìˆ˜ë™ ì•ˆë‚´ë¬¸êµ¬ ì—…ë°ì´íŠ¸
            if (settings.manualInstruction) {
                updateElement('manualInstructionText', settings.manualInstruction, 'innerHTML');
                updateElement('blockedManualInstructionText', settings.manualInstruction, 'innerHTML');
                console.log('ğŸ“‹ ìˆ˜ë™ ì•ˆë‚´ë¬¸êµ¬ ì—…ë°ì´íŠ¸:', settings.manualInstruction);
            }
            
            // í—ˆìš© ìœ„ì¹˜ ì—…ë°ì´íŠ¸
            if (settings.allowedLocations && settings.allowedLocations.length > 0) {
                if (window.CONFIG) {
                    window.CONFIG.ALLOWED_LOCATIONS = settings.allowedLocations;
                    console.log('ğŸ“ í—ˆìš© ìœ„ì¹˜ ì—…ë°ì´íŠ¸:', window.CONFIG.ALLOWED_LOCATIONS);
                } else {
                    // CONFIG ê°ì²´ê°€ ì•„ì§ ì—†ìœ¼ë©´ ë‚˜ì¤‘ì— ì„¤ì •
                    window.pendingAllowedLocations = settings.allowedLocations;
                    console.log('ğŸ“ í—ˆìš© ìœ„ì¹˜ ëŒ€ê¸° ì¤‘:', settings.allowedLocations);
                }
            }
        }

        function updateElement(id, content, method = 'textContent') {
            const element = document.getElementById(id);
            if (element) {
                const oldContent = element[method];
                element[method] = content;
                console.log(`ğŸ”„ ${id} ì—…ë°ì´íŠ¸: "${oldContent}" â†’ "${content}"`);
                
                // ëª¨ë°”ì¼ì—ì„œ ê°•ì œ ë¦¬í”Œë¡œìš° íŠ¸ë¦¬ê±°
                if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                    element.style.display = 'none';
                    element.offsetHeight; // ê°•ì œ ë¦¬í”Œë¡œìš°
                    element.style.display = '';
                }
                
                return true;
            } else {
                console.warn(`âš ï¸ ìš”ì†Œ "${id}" ì°¾ì„ ìˆ˜ ì—†ìŒ`);
                return false;
            }
        }

        function loadIndividualSettings() {
            console.log('ğŸ”„ ê°œë³„ ì„¤ì • í‚¤ ë¡œë“œ ì‹œì‘...');
            
            const individualSettings = [
                { key: 'eventTitle', elementId: 'eventTitle', method: 'textContent' },
                { key: 'eventDescription', elementId: 'eventDescription', method: 'textContent' },
                { key: 'manualInstruction', elementId: 'manualInstructionText', method: 'innerHTML' },
                { key: 'manualInstruction', elementId: 'blockedManualInstructionText', method: 'innerHTML' }
            ];

            individualSettings.forEach(({ key, elementId, method }) => {
                const value = localStorage.getItem(key);
                if (value) {
                    updateElement(elementId, value, method);
                    console.log(`âœ… ê°œë³„ ì„¤ì • ì ìš©: ${key} â†’ ${elementId}`);
                } else {
                    console.log(`âŒ ê°œë³„ ì„¤ì • ì—†ìŒ: ${key}`);
                }
            });

            // í—ˆìš© ìœ„ì¹˜ ê°œë³„ ë¡œë“œ
            const allowedLocations = localStorage.getItem('allowedLocations');
            if (allowedLocations) {
                try {
                    const locations = JSON.parse(allowedLocations);
                    if (window.CONFIG) {
                        window.CONFIG.ALLOWED_LOCATIONS = locations;
                    } else {
                        window.pendingAllowedLocations = locations;
                    }
                    console.log('âœ… ê°œë³„ í—ˆìš© ìœ„ì¹˜ ì ìš©:', locations);
                } catch (e) {
                    console.warn('âš ï¸ í—ˆìš© ìœ„ì¹˜ íŒŒì‹± ì˜¤ë¥˜:', e);
                }
            }
        }

        function forceReapplySettings() {
            console.log('ğŸ’ª ê°•ì œ ì„¤ì • ì¬ì ìš© ì‹œì‘...');
            
            // DOMì—ì„œ í˜„ì¬ ê°’ í™•ì¸
            const currentTitle = document.getElementById('eventTitle').textContent;
            const currentDesc = document.getElementById('eventDescription').textContent;
            
            console.log('ğŸ“Š í˜„ì¬ DOM ìƒíƒœ:');
            console.log('  ì œëª©:', currentTitle);
            console.log('  ì„¤ëª…:', currentDesc);
            
            // localStorageì—ì„œ ë‹¤ì‹œ í™•ì¸í•˜ì—¬ ì ìš©
            const configKeys = ['attendanceConfig', 'eventConfig', 'checkConfig'];
            
            for (const key of configKeys) {
                const configData = localStorage.getItem(key);
                if (configData) {
                    try {
                        const config = JSON.parse(configData);
                        console.log(`ğŸ” ${key}ì—ì„œ ì¬ì ìš©:`, config);
                        
                        if (config.eventTitle && config.eventTitle !== currentTitle) {
                            console.log('ğŸ”¥ ì œëª© ê°•ì œ ì—…ë°ì´íŠ¸:', config.eventTitle);
                            
                            // ì—¬ëŸ¬ ë°©ë²•ìœ¼ë¡œ ë™ì‹œ ì‹œë„
                            const titleEl = document.getElementById('eventTitle');
                            titleEl.textContent = config.eventTitle;
                            titleEl.innerHTML = config.eventTitle;
                            titleEl.innerText = config.eventTitle;
                            document.title = config.eventTitle;
                            
                            // ëª¨ë°”ì¼ì—ì„œ ì¶”ê°€ ê°•ì œ ì—…ë°ì´íŠ¸
                            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                                titleEl.style.fontSize = '27px';
                                setTimeout(() => titleEl.style.fontSize = '28px', 1);
                            }
                        }
                        
                        if (config.eventDescription && config.eventDescription !== currentDesc) {
                            console.log('ğŸ”¥ ì„¤ëª… ê°•ì œ ì—…ë°ì´íŠ¸:', config.eventDescription);
                            
                            const descEl = document.getElementById('eventDescription');
                            descEl.textContent = config.eventDescription;
                            descEl.innerHTML = config.eventDescription;
                            descEl.innerText = config.eventDescription;
                            
                            // ëª¨ë°”ì¼ì—ì„œ ì¶”ê°€ ê°•ì œ ì—…ë°ì´íŠ¸
                            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                                descEl.style.fontSize = '15px';
                                setTimeout(() => descEl.style.fontSize = '16px', 1);
                            }
                        }
                        
                        // ìˆ˜ë™ ì•ˆë‚´ë¬¸êµ¬ë„ ê°•ì œ ì—…ë°ì´íŠ¸
                        if (config.manualInstruction) {
                            ['manualInstructionText', 'blockedManualInstructionText'].forEach(id => {
                                const el = document.getElementById(id);
                                if (el) {
                                    el.innerHTML = config.manualInstruction;
                                }
                            });
                        }
                        
                        break; // ì²« ë²ˆì§¸ ìœ íš¨í•œ ì„¤ì •ë§Œ ì‚¬ìš©
                    } catch (e) {
                        console.warn(`âš ï¸ ${key} ì¬íŒŒì‹± ì˜¤ë¥˜:`, e);
                    }
                }
            }
            
            // ëª¨ë°”ì¼ì—ì„œ ë¸Œë£¨íŠ¸ í¬ìŠ¤ ì ìš©
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                bruteForceDOMUpdate();
            }
        }

        // ìºì‹œ ì™„ì „ ë¬´ë ¥í™” í•¨ìˆ˜
        function nukeMobileCache() {
            console.log('â˜¢ï¸ ëª¨ë°”ì¼ ìºì‹œ ì™„ì „ ë¬´ë ¥í™” ì‹œì‘');
            
            try {
                // 1. ë©”íƒ€ íƒœê·¸ë¡œ ìºì‹œ ë¬´ë ¥í™”
                const noCache = document.createElement('meta');
                noCache.httpEquiv = 'Cache-Control';
                noCache.content = 'no-cache, no-store, must-revalidate, max-age=0';
                document.head.appendChild(noCache);
                
                const pragma = document.createElement('meta');
                pragma.httpEquiv = 'Pragma';
                pragma.content = 'no-cache';
                document.head.appendChild(pragma);
                
                const expires = document.createElement('meta');
                expires.httpEquiv = 'Expires';
                expires.content = '0';
                document.head.appendChild(expires);
                
                // 2. URLì— ìºì‹œ ë²„ìŠ¤í„° ì¶”ê°€ (í˜„ì¬ URL íˆìŠ¤í† ë¦¬ ì¡°ì‘)
                const currentUrl = new URL(window.location);
                currentUrl.searchParams.set('_cb', Date.now());
                window.history.replaceState({}, '', currentUrl);
                
                // 3. localStorageë¥¼ ë‹¤ì‹œ ì½ì–´ì„œ ê°•ì œ ì ìš©
                setTimeout(() => {
                    console.log('â˜¢ï¸ ìºì‹œ ë¬´ë ¥í™” í›„ ì„¤ì • ì¬ë¡œë“œ');
                    loadAdminSettings();
                }, 10);
                
                console.log('â˜¢ï¸ ëª¨ë°”ì¼ ìºì‹œ ë¬´ë ¥í™” ì™„ë£Œ');
                
            } catch (e) {
                console.warn('âš ï¸ ìºì‹œ ë¬´ë ¥í™” ì‹¤íŒ¨:', e);
            }
        }

        // êµ¬ì„± ì„¤ì •
        const CONFIG = {
            // Google Apps Script URL (ì‹¤ì œ ë°°í¬ëœ URLë¡œ ë³€ê²½ í•„ìš”)
            GOOGLE_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbx9E3st904bHJ5F_T8q7rUNI87KpDhKXj7IWRxCRwHywdok1WYUC-MKMwq9jPd03s7_Jw/exec',
            // ì¬ì‹œë„ ì„¤ì •
            MAX_RETRIES: 3,
            RETRY_DELAY: 1000, // 1ì´ˆ
            
            // ìœ„ì¹˜ ì„¤ì •
            GPS_TIMEOUT: 15000, // 15ì´ˆ
            GPS_MAX_AGE: 300000, // 5ë¶„
            
            // í—ˆìš©ëœ ìœ„ì¹˜ (ê´€ë¦¬ì ì„¤ì •ìœ¼ë¡œ ë®ì–´ì¨ì§ˆ ìˆ˜ ìˆìŒ)
            ALLOWED_LOCATIONS: [
                {
                    name: "ë‹¨í˜¸í™€",
                    lat: 37.228848,
                    lng: 127.167855,
                    radius: 30
                },
                {
                    name: "ë²½ì†Œí™€", 
                    lat: 37.228767,
                    lng: 127.167449,
                    radius: 30
                },
                {
                    name: "ëŒ€í•™êµ ë³¸ê´€",
                    lat: 37.227239,
                    lng: 127.166598,
                    radius: 50
                }
            ]
        };

        class AttendanceSystem {
            constructor() {
                this.deviceFingerprint = this.generateDeviceFingerprint();
                this.autocompleteData = {};
                this.currentLocation = null;
                this.locationVerified = false;
                this.submissionAttempts = 0;
                this.init();
            }

            generateDeviceFingerprint() {
                try {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    ctx.textBaseline = 'top';
                    ctx.font = '14px Arial';
                    ctx.fillText('Device fingerprint test', 2, 2);
                    
                    const fingerprint = {
                        userAgent: navigator.userAgent,
                        language: navigator.language,
                        languages: navigator.languages?.join(',') || '',
                        platform: navigator.platform,
                        screen: `${screen.width}x${screen.height}x${screen.colorDepth}`,
                        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                        canvas: canvas.toDataURL(),
                        cookieEnabled: navigator.cookieEnabled,
                        doNotTrack: navigator.doNotTrack || 'unspecified',
                        hardwareConcurrency: navigator.hardwareConcurrency || 0,
                        touchSupport: 'ontouchstart' in window,
                        webglRenderer: this.getWebGLRenderer()
                    };

                    return this.simpleHash(JSON.stringify(fingerprint));
                } catch (error) {
                    console.warn('Fingerprint generation error:', error);
                    return this.simpleHash(navigator.userAgent + Date.now());
                }
            }

            getWebGLRenderer() {
                try {
                    const canvas = document.createElement('canvas');
                    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                    if (gl) {
                        const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                        return debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : 'unknown';
                    }
                    return 'not_supported';
                } catch (error) {
                    return 'error';
                }
            }

            simpleHash(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return Math.abs(hash).toString(36);
            }

            init() {
                // ëŒ€ê¸° ì¤‘ì¸ í—ˆìš© ìœ„ì¹˜ê°€ ìˆìœ¼ë©´ ì ìš©
                if (window.pendingAllowedLocations) {
                    CONFIG.ALLOWED_LOCATIONS = window.pendingAllowedLocations;
                    delete window.pendingAllowedLocations;
                    console.log('ğŸ“ ëŒ€ê¸° ì¤‘ì´ë˜ í—ˆìš© ìœ„ì¹˜ ì ìš©:', CONFIG.ALLOWED_LOCATIONS);
                }

                this.updateTimestamp();
                this.displayDeviceInfo();
                
                if (this.checkIfBlocked()) {
                    return;
                }
                
                this.setupEventListeners();
                this.detectAutocomplete();
                
                setInterval(() => this.updateTimestamp(), 1000);

                // ëª¨ë°”ì¼ì—ì„œ ì¶”ê°€ ë””ë²„ê·¸ ì •ë³´ í‘œì‹œ
                if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                    document.getElementById('debugInfo').style.display = 'block';
                    updateDebugInfo();
                    
                    // ì¦‰ì‹œ ì§„ë‹¨ ì‹¤í–‰
                    setTimeout(() => {
                        diagnoseMobileIssue();
                    }, 200);
                }
            }

            checkIfBlocked() {
                const sessionBlocked = sessionStorage.getItem('attendance_submitted');
                const deviceBlocked = localStorage.getItem(`attendance_${this.deviceFingerprint}`);
                
                const cookies = document.cookie.split(';').map(c => c.trim());
                const cookieBlocked = cookies.some(cookie => 
                    cookie.startsWith(`attendance_${this.deviceFingerprint}=`)
                );

                if (sessionBlocked || deviceBlocked || cookieBlocked) {
                    this.showBlockedMessage();
                    return true;
                }
                return false;
            }

            showBlockedMessage() {
                document.getElementById('attendanceForm').style.display = 'none';
                document.getElementById('blockedMessage').style.display = 'block';
            }

            setupEventListeners() {
                const form = document.getElementById('checkInForm');
                const inputs = form.querySelectorAll('input[autocomplete]');

                inputs.forEach(input => {
                    input.addEventListener('input', () => this.checkAutocompleteMatch(input));
                    input.addEventListener('change', () => this.checkAutocompleteMatch(input));
                });

                document.getElementById('locationBtn').addEventListener('click', () => this.checkLocation());
                document.getElementById('modalCloseBtn').addEventListener('click', () => this.hideModal());
                
                form.addEventListener('submit', (e) => this.handleSubmit(e));

                // í˜ì´ì§€ ìˆ¨ê¹€/í‘œì‹œ ì´ë²¤íŠ¸ ì²˜ë¦¬ (ëª¨ë°”ì¼ ë¸Œë¼ìš°ì € ëŒ€ì‘)
                document.addEventListener('visibilitychange', () => {
                    if (!document.hidden) {
                        this.updateTimestamp();
                        // ëª¨ë°”ì¼ì—ì„œ í˜ì´ì§€ ì¬í™œì„±í™” ì‹œ ì„¤ì • ì¬í™•ì¸
                        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                            setTimeout(() => {
                                console.log('ğŸ“± í˜ì´ì§€ ì¬í™œì„±í™”: ì„¤ì • ì¬í™•ì¸');
                                forceReapplySettings();
                                updateDebugInfo();
                            }, 100);
                        }
                    }
                });

                // ëª¨ë°”ì¼ì—ì„œ ìƒˆë¡œê³ ì¹¨ ê°ì§€
                window.addEventListener('pageshow', (event) => {
                    if (event.persisted) {
                        console.log('ğŸ“± ë°±/í¬ì›Œë“œ ìºì‹œì—ì„œ ë³µì›ë¨: ì„¤ì • ì¬ì ìš©');
                        setTimeout(() => {
                            loadAdminSettings();
                            updateDebugInfo();
                        }, 50);
                    }
                });
            }

            detectAutocomplete() {
                setTimeout(() => {
                    const inputs = document.querySelectorAll('input[autocomplete]');
                    inputs.forEach(input => {
                        if (input.value && input.value.trim() !== '') {
                            this.autocompleteData[input.name] = input.value.trim();
                            input.classList.add('autocomplete-detected');
                        }
                    });
                }, 500);
            }

            checkAutocompleteMatch(input) {
                const fieldName = input.name;
                const currentValue = input.value.trim();
                const autocompleteValue = this.autocompleteData[fieldName];

                if (autocompleteValue && currentValue && 
                    currentValue.toLowerCase() !== autocompleteValue.toLowerCase()) {
                    this.showWarning('âš ï¸ ì…ë ¥í•˜ì‹  ì •ë³´ì™€ ë¸Œë¼ìš°ì € ìë™ì™„ì„± ì •ë³´ê°€ ë‹¤ë¦…ë‹ˆë‹¤.');
                } else {
                    this.hideWarning();
                }
            }

            showWarning(message) {
                const warningDiv = document.getElementById('warningMessage');
                warningDiv.textContent = message;
                warningDiv.style.display = 'block';
            }

            hideWarning() {
                document.getElementById('warningMessage').style.display = 'none';
            }

            showModal(type, title, message) {
                const modalOverlay = document.getElementById('customModal');
                const modalIcon = document.getElementById('modalIcon');
                const modalTitle = document.getElementById('modalTitle');
                const modalMessage = document.getElementById('modalMessage');

                modalIcon.className = `modal-icon ${type}`;
                switch(type) {
                    case 'success': modalIcon.textContent = 'âœ…'; break;
                    case 'error': modalIcon.textContent = 'âŒ'; break;
                    case 'warning': modalIcon.textContent = 'âš ï¸'; break;
                    default: modalIcon.textContent = 'â„¹ï¸';
                }

                modalTitle.textContent = title;
                modalMessage.innerHTML = message;
                
                modalOverlay.classList.add('active');
            }

            hideModal() {
                document.getElementById('customModal').classList.remove('active');
            }

            async checkLocation() {
                const locationBtn = document.getElementById('locationBtn');
                const locationInfo = document.getElementById('locationInfo');
                const locationResult = document.getElementById('locationResult');

                this.setLocationButtonState('checking');
                locationInfo.style.display = 'block';

                try {
                    if (!navigator.geolocation) {
                        throw new Error('ì´ ë¸Œë¼ìš°ì €ëŠ” GPS ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    }

                    const position = await this.getCurrentPosition();
                    const { latitude, longitude, accuracy } = position.coords;

                    console.log(`GPS ì •í™•ë„: ${accuracy}m`);

                    const allowedLocation = this.isLocationAllowed(latitude, longitude);

                    if (allowedLocation) {
                        this.locationVerified = true;
                        this.currentLocation = {
                            lat: latitude,
                            lng: longitude,
                            name: allowedLocation.name,
                            distance: allowedLocation.distance,
                            accuracy: accuracy
                        };

                        this.setLocationButtonState('success');
                        
                        locationResult.innerHTML = `
                            <div class="location-success">
                                <strong>âœ… ìœ„ì¹˜ í™•ì¸ ì„±ê³µ!</strong><br>
                                í˜„ì¬ ìœ„ì¹˜: ${allowedLocation.name}<br>
                                ê±°ë¦¬: ì•½ ${Math.round(allowedLocation.distance)}m<br>
                                ì •í™•ë„: Â±${Math.round(accuracy)}m
                            </div>
                            <div class="coordinates-info">
                                ì¢Œí‘œ: ${latitude.toFixed(6)}, ${longitude.toFixed(6)}
                            </div>
                        `;

                        document.getElementById('location').value = allowedLocation.name;
                        document.getElementById('coordinates').value = `${latitude},${longitude}`;

                    } else {
                        throw new Error(`í—ˆìš©ëœ ìœ„ì¹˜ê°€ ì•„ë‹™ë‹ˆë‹¤. ì„¸ë¯¸ë‚˜ì‹¤ ë‚´ë¶€ì—ì„œ ì‹œë„í•´ ì£¼ì„¸ìš”. (ì •í™•ë„: Â±${Math.round(accuracy)}m)`);
                    }

                } catch (error) {
                    console.error('ìœ„ì¹˜ í™•ì¸ ì˜¤ë¥˜:', error);
                    this.handleLocationError(error, locationResult);
                }
            }

            setLocationButtonState(state) {
                const locationBtn = document.getElementById('locationBtn');
                locationBtn.disabled = state === 'checking';
                
                switch(state) {
                    case 'checking':
                        locationBtn.className = 'location-btn checking';
                        locationBtn.innerHTML = 'ğŸ”„ ìœ„ì¹˜ í™•ì¸ ì¤‘...';
                        break;
                    case 'success':
                        locationBtn.className = 'location-btn success';
                        locationBtn.innerHTML = 'âœ… ìœ„ì¹˜ í™•ì¸ ì™„ë£Œ';
                        break;
                    case 'error':
                        locationBtn.className = 'location-btn error';
                        locationBtn.innerHTML = 'âŒ ìœ„ì¹˜ í™•ì¸ ì‹¤íŒ¨';
                        setTimeout(() => {
                            locationBtn.disabled = false;
                            locationBtn.className = 'location-btn';
                            locationBtn.innerHTML = 'ğŸ“ ìœ„ì¹˜ ë‹¤ì‹œ í™•ì¸';
                        }, 3000);
                        break;
                }
            }

            handleLocationError(error, locationResult) {
                this.setLocationButtonState('error');
                this.locationVerified = false;
                
                document.getElementById('location').value = '';
                document.getElementById('coordinates').value = '';

                let errorMessage = error.message;
                let helpText = '';

                if (error.code) {
                    switch (error.code) {
                        case 1: // PERMISSION_DENIED
                            helpText = 'â€¢ ë¸Œë¼ìš°ì € ì£¼ì†Œì°½ì˜ ìœ„ì¹˜ ì•„ì´ì½˜ì„ í´ë¦­í•˜ì—¬ í—ˆìš©í•´ì£¼ì„¸ìš”<br>â€¢ ì„¤ì • > ê°œì¸ì •ë³´ ë³´í˜¸ > ìœ„ì¹˜ ì„œë¹„ìŠ¤ì—ì„œ í—ˆìš©í•´ì£¼ì„¸ìš”';
                            break;
                        case 2: // POSITION_UNAVAILABLE
                            helpText = 'â€¢ WiFië¥¼ ì¼œì£¼ì„¸ìš”<br>â€¢ ê±´ë¬¼ ë°–ì—ì„œ í•œ ë²ˆ ì‹œë„í•´ë³´ì„¸ìš”<br>â€¢ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”';
                            break;
                        case 3: // TIMEOUT
                            helpText = 'â€¢ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”<br>â€¢ WiFi ì‹ í˜¸ê°€ ê°•í•œ ê³³ì—ì„œ ì‹œë„í•´ì£¼ì„¸ìš”';
                            break;
                    }
                }

                locationResult.innerHTML = `
                    <div class="location-error">
                        <strong>âŒ ìœ„ì¹˜ í™•ì¸ ì‹¤íŒ¨</strong><br>
                        ${errorMessage}<br><br>
                        <small style="font-size: 12px; line-height: 1.4;">
                            ${helpText || 'â€¢ GPS ê¶Œí•œì„ í—ˆìš©í•´ ì£¼ì„¸ìš”<br>â€¢ ì„¸ë¯¸ë‚˜ì‹¤ ë‚´ë¶€ì—ì„œ ì‹œë„í•´ ì£¼ì„¸ìš”<br>â€¢ WiFiì™€ ìœ„ì¹˜ ì„œë¹„ìŠ¤ë¥¼ ì¼œì£¼ì„¸ìš”'}
                        </small>
                    </div>
                `;

                this.showModal('error', 'ìœ„ì¹˜ í™•ì¸ ì‹¤íŒ¨', errorMessage);
            }

            getCurrentPosition() {
                return new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(
                        resolve,
                        reject,
                        {
                            enableHighAccuracy: true,
                            timeout: CONFIG.GPS_TIMEOUT,
                            maximumAge: CONFIG.GPS_MAX_AGE
                        }
                    );
                });
            }

            isLocationAllowed(lat, lng) {
                for (const location of CONFIG.ALLOWED_LOCATIONS) {
                    const distance = this.calculateDistance(lat, lng, location.lat, location.lng);
                    if (distance <= location.radius) {
                        return { name: location.name, distance: distance };
                    }
                }
                return null;
            }

            calculateDistance(lat1, lng1, lat2, lng2) {
                const R = 6371e3;
                const Ï†1 = lat1 * Math.PI/180;
                const Ï†2 = lat2 * Math.PI/180;
                const Î”Ï† = (lat2-lat1) * Math.PI/180;
                const Î”Î» = (lng2-lng1) * Math.PI/180;

                const a = Math.sin(Î”Ï†/2) * Math.sin(Î”Ï†/2) +
                          Math.cos(Ï†1) * Math.cos(Ï†2) *
                          Math.sin(Î”Î»/2) * Math.sin(Î”Î»/2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

                return R * c;
            }

            async handleSubmit(e) {
                e.preventDefault();
                
                if (this.checkIfBlocked()) {
                    return;
                }

                const formData = new FormData(e.target);
                const submitBtn = document.getElementById('submitBtn');
                
                submitBtn.disabled = true;
                submitBtn.textContent = 'ì œì¶œ ì¤‘...';

                try {
                    if (!this.validateForm(formData)) {
                        return;
                    }

                    await this.submitDataWithRetry(formData);

                    this.markAsSubmitted();
                    this.showModal('success', 'ì¶œì„ ì²´í¬ ì™„ë£Œ!', 'âœ… ì¶œì„ ì²´í¬ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    
                    setTimeout(() => {
                        this.showBlockedMessage();
                    }, 2000);

                } catch (error) {
                    console.error('ì œì¶œ ì˜¤ë¥˜:', error);
                    this.showModal('error', 'ì œì¶œ ì‹¤íŒ¨', 
                        `âŒ ì¶œì„ ì²´í¬ ì œì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.<br><small>${error.message}</small>`);
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'ì¶œì„ ì²´í¬ ì™„ë£Œ';
                }
            }

            validateForm(formData) {
                const name = formData.get('name')?.trim();
                const affiliation = formData.get('affiliation')?.trim();
                const location = formData.get('location');

                if (!name || !affiliation) {
                    this.showModal('warning', 'í•„ìˆ˜ í•­ëª© ëˆ„ë½', 
                        'ì´ë¦„ê³¼ ì†Œì†ì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.');
                    return false;
                }

                if (name.length < 2 || name.length > 50) {
                    this.showModal('warning', 'ì´ë¦„ ì˜¤ë¥˜', 
                        'ì´ë¦„ì€ 2ì ì´ìƒ 50ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return false;
                }

                if (affiliation.length < 2 || affiliation.length > 100) {
                    this.showModal('warning', 'ì†Œì† ì˜¤ë¥˜', 
                        'ì†Œì†ì€ 2ì ì´ìƒ 100ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return false;
                }

                if (!this.locationVerified || !location) {
                    this.showModal('warning', 'ìœ„ì¹˜ ë¯¸í™•ì¸', 
                        'GPS ìœ„ì¹˜ í™•ì¸ì„ ë¨¼ì € ì™„ë£Œí•´ ì£¼ì„¸ìš”.');
                    return false;
                }

                return true;
            }

            async submitDataWithRetry(formData) {
                this.submissionAttempts = 0;
                
                while (this.submissionAttempts < CONFIG.MAX_RETRIES) {
                    try {
                        this.submissionAttempts++;
                        return await this.submitData(formData);
                    } catch (error) {
                        console.warn(`ì œì¶œ ì‹œë„ ${this.submissionAttempts}/${CONFIG.MAX_RETRIES} ì‹¤íŒ¨:`, error);
                        
                        if (this.submissionAttempts >= CONFIG.MAX_RETRIES) {
                            throw new Error(`${CONFIG.MAX_RETRIES}ë²ˆ ì‹œë„ í›„ ì‹¤íŒ¨: ${error.message}`);
                        }
                        
                        // ì¬ì‹œë„ ì „ ëŒ€ê¸°
                        await new Promise(resolve => 
                            setTimeout(resolve, CONFIG.RETRY_DELAY * this.submissionAttempts)
                        );
                    }
                }
            }

            async submitData(formData) {
                const submitData = {
                    name: formData.get('name')?.trim(),
                    affiliation: formData.get('affiliation')?.trim(),
                    email: formData.get('email')?.trim() || '',
                    phone: formData.get('phone')?.trim() || '',
                    location: formData.get('location'),
                    coordinates: formData.get('coordinates') || '',
                    timestamp: new Date().toISOString(),
                    timestampKor: new Date().toLocaleString('ko-KR'),
                    deviceId: this.deviceFingerprint,
                    userAgent: navigator.userAgent,
                    submissionAttempt: this.submissionAttempts
                };

                // localStorageì— ì¶œì„ ë°ì´í„° ì €ì¥ (ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ í™•ì¸ìš©)
                try {
                    const existingData = JSON.parse(localStorage.getItem('attendanceData') || '[]');
                    existingData.push(submitData);
                    localStorage.setItem('attendanceData', JSON.stringify(existingData));
                    console.log('localStorageì— ì¶œì„ ë°ì´í„° ì €ì¥ ì™„ë£Œ');
                } catch (storageError) {
                    console.warn('localStorage ì €ì¥ ì‹¤íŒ¨:', storageError);
                }

                if (CONFIG.GOOGLE_SCRIPT_URL && !CONFIG.GOOGLE_SCRIPT_URL.includes('YOUR_SCRIPT_ID')) {
                    console.log('Google Apps Scriptë¡œ ë°ì´í„° ì „ì†¡ ì‹œë„ ì¤‘...');
                    return await this.submitToAppsScript(submitData);
                }
                
                console.warn('Google Apps Script URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                console.log('ì œì¶œ ë°ì´í„° (ì‹œë®¬ë ˆì´ì…˜):', submitData);
                
                // ê°œë°œ/í…ŒìŠ¤íŠ¸ ëª¨ë“œ ì‹œë®¬ë ˆì´ì…˜
                await new Promise(resolve => setTimeout(resolve, 1000));
                return { success: true, message: 'URL ë¯¸ì„¤ì •ìœ¼ë¡œ ì‹œë®¬ë ˆì´ì…˜ë¨' };
            }

            async submitToAppsScript(data) {
                try {
                    console.log('Apps Script URL:', CONFIG.GOOGLE_SCRIPT_URL);
                    console.log('ì œì¶œ ë°ì´í„°:', data);

                    const response = await fetch(CONFIG.GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });

                    console.log('no-cors ëª¨ë“œë¡œ ì „ì†¡ ì™„ë£Œ');
                    return { success: true, message: 'no-cors ëª¨ë“œë¡œ ì „ì†¡ë¨', mode: 'no-cors' };

                } catch (noCorsError) {
                    console.warn('no-cors ëª¨ë“œ ì‹¤íŒ¨, JSONP ë°©ì‹ìœ¼ë¡œ ì¬ì‹œë„:', noCorsError);
                    return await this.submitViaJSONP(data);
                }
            }

            async submitViaJSONP(data) {
                return new Promise((resolve, reject) => {
                    const callbackName = 'jsonpCallback' + Date.now() + Math.floor(Math.random() * 1000);
                    
                    console.log('JSONP ìš”ì²­ ì‹œì‘:', callbackName);
                    
                    window[callbackName] = function(response) {
                        console.log('JSONP ì½œë°± ì‹¤í–‰ë¨:', response);
                        cleanup();
                        resolve(response);
                    };

                    const timeoutId = setTimeout(() => {
                        console.warn('JSONP íƒ€ì„ì•„ì›ƒ ë°œìƒ');
                        cleanup();
                        reject(new Error('JSONP ìš”ì²­ íƒ€ì„ì•„ì›ƒ (15ì´ˆ)'));
                    }, 15000);

                    const cleanup = () => {
                        if (window[callbackName]) {
                            delete window[callbackName];
                        }
                        if (script && script.parentNode) {
                            script.parentNode.removeChild(script);
                        }
                        if (timeoutId) {
                            clearTimeout(timeoutId);
                        }
                    };

                    const params = new URLSearchParams();
                    params.append('callback', callbackName);
                    params.append('data', JSON.stringify(data));
                    
                    const fullUrl = `${CONFIG.GOOGLE_SCRIPT_URL}?${params.toString()}`;
                    console.log('JSONP ìš”ì²­ URL:', fullUrl);

                    const script = document.createElement('script');
                    script.src = fullUrl;
                    script.onload = function() {
                        console.log('JSONP ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì„±ê³µ');
                    };
                    script.onerror = function(event) {
                        console.error('JSONP ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', event);
                        cleanup();
                        reject(new Error('JSONP ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨'));
                    };

                    console.log('JSONP ìŠ¤í¬ë¦½íŠ¸ DOMì— ì¶”ê°€');
                    document.head.appendChild(script);
                });
            }

            markAsSubmitted() {
                const timestamp = Date.now().toString();
                
                try {
                    sessionStorage.setItem('attendance_submitted', 'true');
                    sessionStorage.setItem('attendance_timestamp', timestamp);
                } catch (e) {
                    console.warn('SessionStorage ì €ì¥ ì‹¤íŒ¨:', e);
                }

                try {
                    localStorage.setItem(`attendance_${this.deviceFingerprint}`, timestamp);
                } catch (e) {
                    console.warn('LocalStorage ì €ì¥ ì‹¤íŒ¨:', e);
                }
                
                try {
                    document.cookie = `attendance_${this.deviceFingerprint}=submitted; max-age=${30*24*60*60}; path=/; SameSite=Lax; Secure`;
                } catch (e) {
                    console.warn('Cookie ì €ì¥ ì‹¤íŒ¨:', e);
                }
            }

            updateTimestamp() {
                try {
                    const now = new Date();
                    const timeString = now.toLocaleString('ko-KR', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit',
                        weekday: 'short'
                    });
                    document.getElementById('timestamp').textContent = `í˜„ì¬ ì‹œê°„: ${timeString}`;
                } catch (error) {
                    console.warn('íƒ€ì„ìŠ¤íƒ¬í”„ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                }
            }

            displayDeviceInfo() {
                try {
                    const deviceInfo = document.getElementById('deviceInfo');
                    const browserName = this.getBrowserName();
                    const osName = this.getOSName();
                    
                    deviceInfo.innerHTML = `
                        <strong>ê¸°ê¸° ì •ë³´:</strong><br>
                        ë¸Œë¼ìš°ì €: ${browserName}<br>
                        ìš´ì˜ì²´ì œ: ${osName}<br>
                        í™”ë©´: ${screen.width}Ã—${screen.height} (${screen.colorDepth}bit)<br>
                        ì–¸ì–´: ${navigator.language}<br>
                        í„°ì¹˜: ${('ontouchstart' in window) ? 'ì§€ì›' : 'ë¯¸ì§€ì›'}<br>
                        ê¸°ê¸° ID: ${this.deviceFingerprint.substring(0, 8)}...
                    `;
                } catch (error) {
                    console.warn('ê¸°ê¸° ì •ë³´ í‘œì‹œ ì˜¤ë¥˜:', error);
                }
            }

            getBrowserName() {
                const ua = navigator.userAgent;
                if (ua.includes('Chrome')) return 'Chrome';
                if (ua.includes('Firefox')) return 'Firefox';
                if (ua.includes('Safari')) return 'Safari';
                if (ua.includes('Edge')) return 'Edge';
                return 'Unknown';
            }

            getOSName() {
                const ua = navigator.userAgent;
                if (ua.includes('Windows')) return 'Windows';
                if (ua.includes('Mac')) return 'macOS';
                if (ua.includes('Linux')) return 'Linux';
                if (ua.includes('Android')) return 'Android';
                if (ua.includes('iPhone') || ua.includes('iPad')) return 'iOS';
                return navigator.platform || 'Unknown';
            }
        }

        // ì„¤ì • ë™ê¸°í™” ê²€ì‚¬ í•¨ìˆ˜ (ëª¨ë°”ì¼ ì „ìš©)
        function periodicSettingsCheck() {
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                setInterval(() => {
                    const currentTitle = document.getElementById('eventTitle').textContent;
                    const configData = localStorage.getItem('attendanceConfig');
                    
                    if (configData) {
                        try {
                            const config = JSON.parse(configData);
                            if (config.eventTitle && config.eventTitle !== currentTitle && currentTitle === 'ğŸ“ ì„¸ë¯¸ë‚˜ì‹¤ ì¶œì„ ì²´í¬') {
                                console.log('ğŸ“± ì£¼ê¸°ì  ê²€ì‚¬: ì„¤ì • ë¶ˆì¼ì¹˜ ë°œê²¬, ì¬ì ìš©');
                                loadAdminSettings();
                                updateDebugInfo();
                            }
                        } catch (e) {
                            console.warn('âš ï¸ ì£¼ê¸°ì  ì„¤ì • ê²€ì‚¬ ì˜¤ë¥˜:', e);
                        }
                    }
                }, 5000); // 5ì´ˆë§ˆë‹¤ ê²€ì‚¬
            }
        }

        // Storage ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ë‹¤ë¥¸ íƒ­ì—ì„œ ì„¤ì • ë³€ê²½ ê°ì§€)
        window.addEventListener('storage', function(e) {
            console.log('ğŸ“¡ Storage ì´ë²¤íŠ¸ ê°ì§€:', e.key, e.newValue);
            
            if (e.key === 'attendanceConfig' || e.key === 'eventTitle' || e.key === 'eventDescription') {
                console.log('ğŸ“± ì„¤ì • ë³€ê²½ ê°ì§€: ì¦‰ì‹œ ì¬ì ìš©');
                setTimeout(() => {
                    loadAdminSettings();
                    updateDebugInfo();
                }, 100);
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ ê´€ë¦¬ì ì„¤ì • ë¡œë“œ ë° ì‹œìŠ¤í…œ ì´ˆê¸°í™” (ì´ˆê°•ë ¥ ë²„ì „)
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸš€ DOMContentLoaded ì´ë²¤íŠ¸ ì‹œì‘');
            
            try {
                // ëª¨ë°”ì¼ì—ì„œ ì¦‰ì‹œ ìºì‹œ ë¬´ë ¥í™”
                if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                    nukeMobileCache();
                }
                
                // 1. ê´€ë¦¬ì ì„¤ì •ì„ ë¨¼ì € ë¡œë“œ
                loadAdminSettings();
                
                // 2. ì§§ì€ ì§€ì—° í›„ ì¶œì„ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
                setTimeout(() => {
                    new AttendanceSystem();
                    console.log('âœ… ì¶œì„ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
                }, 100);
                
                // 3. ëª¨ë°”ì¼ì—ì„œ ì¶”ê°€ ì§€ì—° í›„ ì¬í™•ì¸
                if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                    setTimeout(() => {
                        console.log('ğŸ“± ëª¨ë°”ì¼: ì¶”ê°€ ì„¤ì • ì¬í™•ì¸');
                        forceReapplySettings();
                        updateDebugInfo();
                    }, 500);
                    
                    // 4. ì£¼ê¸°ì  ì„¤ì • ê²€ì‚¬ ì‹œì‘
                    periodicSettingsCheck();
                    
                    // 5. ê°•ë ¥í•œ ì£¼ê¸°ì  ê°•ì œ ì—…ë°ì´íŠ¸ (ëª¨ë°”ì¼ ì „ìš©)
                    setInterval(() => {
                        console.log('ğŸ“± ì£¼ê¸°ì  ê°•ì œ ì—…ë°ì´íŠ¸');
                        bruteForceDOMUpdate();
                    }, 10000); // 10ì´ˆë§ˆë‹¤
                }
                
                console.log('âœ… í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ - ê´€ë¦¬ì ì„¤ì • ë° ì¶œì„ ì‹œìŠ¤í…œ ì´ˆê¸°í™”ë¨');
                
            } catch (error) {
                console.error('âŒ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                alert('ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
            }
        });

        // ì¶”ê°€: ì™„ì „í•œ ìƒˆë¡œê³ ì¹¨ ê°•ì œ í•¨ìˆ˜ (ëª¨ë°”ì¼ìš©)
        function forceTotalRefresh() {
            console.log('ğŸ”„ ì™„ì „í•œ ìƒˆë¡œê³ ì¹¨ ê°•ì œ ì‹¤í–‰');
            
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                // ëª¨ë“  ìºì‹œ ê´€ë ¨ ìŠ¤í† ë¦¬ì§€ í´ë¦¬ì–´ í›„ ìƒˆë¡œê³ ì¹¨
                if ('caches' in window) {
                    caches.keys().then(names => {
                        names.forEach(name => {
                            caches.delete(name);
                        });
                    });
                }
                
                // ì„œë¹„ìŠ¤ ì›Œì»¤ê°€ ìˆë‹¤ë©´ ì—…ë°ì´íŠ¸
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.getRegistrations().then(registrations => {
                        registrations.forEach(registration => {
                            registration.update();
                        });
                    });
                }
                
                // ìºì‹œ ë²„ìŠ¤í„°ì™€ í•¨ê»˜ ê°•ì œ ìƒˆë¡œê³ ì¹¨
                setTimeout(() => {
                    window.location.href = window.location.href + '?_force=' + Date.now();
                }, 100);
            }
        }

        // ëª¨ë°”ì¼ì—ì„œ ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ ì¶”ê°€ (ë‹¨ìˆœí™”ëœ ë²„ì „)
        function addManualRefreshButton() {
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                // ë²„íŠ¼ ì»¨í…Œì´ë„ˆ ìƒì„±
                const buttonContainer = document.createElement('div');
                buttonContainer.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    z-index: 9999;
                    display: flex;
                    flex-direction: column;
                    gap: 5px;
                `;
                
                // ê°•ì œ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼
                const refreshBtn = document.createElement('button');
                refreshBtn.innerHTML = 'ğŸ”„ ìƒˆë¡œê³ ì¹¨';
                refreshBtn.style.cssText = `
                    background: #ff6b6b;
                    color: white;
                    border: none;
                    padding: 8px 12px;
                    border-radius: 6px;
                    font-size: 11px;
                    font-weight: bold;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                    cursor: pointer;
                `;
                refreshBtn.onclick = () => {
                    console.log('ğŸ”„ ìˆ˜ë™ ê°•ì œ ìƒˆë¡œê³ ì¹¨ ìš”ì²­');
                    forceTotalRefresh();
                };
                
                // ì§„ë‹¨ ë²„íŠ¼
                const diagnoseBtn = document.createElement('button');
                diagnoseBtn.innerHTML = 'ğŸ” ì§„ë‹¨';
                diagnoseBtn.style.cssText = `
                    background: #007bff;
                    color: white;
                    border: none;
                    padding: 8px 12px;
                    border-radius: 6px;
                    font-size: 11px;
                    font-weight: bold;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                    cursor: pointer;
                `;
                diagnoseBtn.onclick = () => {
                    console.log('ğŸ” ëª¨ë°”ì¼ ì§„ë‹¨ ìš”ì²­');
                    diagnoseMobileIssue();
                };
                
                buttonContainer.appendChild(refreshBtn);
                buttonContainer.appendChild(diagnoseBtn);
                document.body.appendChild(buttonContainer);
            }
        }

        function updateDebugInfo() {
            const debugDetails = document.getElementById('debugDetails');
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            let debugText = '';
            debugText += `ëª¨ë°”ì¼: ${isMobile ? 'Yes' : 'No'}<br>`;
            debugText += `User Agent: ${navigator.userAgent.substring(0, 50)}...<br>`;
            debugText += `localStorage í‚¤ ìˆ˜: ${Object.keys(localStorage).length}<br>`;
            
            // ì„¤ì • ê´€ë ¨ í‚¤ í™•ì¸
            const configKeys = [
                'attendanceConfig',
                'eventConfig', 
                'checkConfig',
                'eventTitle',
                'eventDescription',
                'manualInstruction'
            ];
            
            debugText += '<br><strong>ì„¤ì • í‚¤ ìƒíƒœ:</strong><br>';
            configKeys.forEach(key => {
                const exists = localStorage.getItem(key) !== null;
                debugText += `${key}: ${exists ? 'âœ…' : 'âŒ'}<br>`;
            });
            
            // í˜„ì¬ DOM ìƒíƒœ
            debugText += '<br><strong>í˜„ì¬ DOM ìƒíƒœ:</strong><br>';
            debugText += `ì œëª©: "${document.getElementById('eventTitle').textContent}"<br>`;
            debugText += `ì„¤ëª…: "${document.getElementById('eventDescription').textContent}"<br>`;
            
            // localStorage ë‚´ìš© ë¯¸ë¦¬ë³´ê¸°
            const attendanceConfig = localStorage.getItem('attendanceConfig');
            if (attendanceConfig) {
                try {
                    const config = JSON.parse(attendanceConfig);
                    debugText += '<br><strong>ì €ì¥ëœ ì„¤ì •:</strong><br>';
                    debugText += `ì €ì¥ëœ ì œëª©: "${config.eventTitle || 'N/A'}"<br>`;
                    debugText += `ì €ì¥ëœ ì„¤ëª…: "${config.eventDescription || 'N/A'}"<br>`;
                    
                    // ë¶ˆì¼ì¹˜ ê°ì§€
                    const currentTitle = document.getElementById('eventTitle').textContent;
                    const currentDesc = document.getElementById('eventDescription').textContent;
                    
                    if (config.eventTitle && config.eventTitle !== currentTitle) {
                        debugText += '<br><strong>âš ï¸ ë¶ˆì¼ì¹˜ ê°ì§€:</strong><br>';
                        debugText += `ì œëª© ë¶ˆì¼ì¹˜: DOM="${currentTitle}" vs ì €ì¥ë¨="${config.eventTitle}"<br>`;
                    }
                    
                    if (config.eventDescription && config.eventDescription !== currentDesc) {
                        debugText += `ì„¤ëª… ë¶ˆì¼ì¹˜: DOM="${currentDesc}" vs ì €ì¥ë¨="${config.eventDescription}"<br>`;
                    }
                    
                } catch (e) {
                    debugText += '<br><strong>ì„¤ì • íŒŒì‹± ì˜¤ë¥˜:</strong><br>';
                    debugText += `ì˜¤ë¥˜: ${e.message}<br>`;
                }
            } else {
                debugText += '<br><strong>âš ï¸ ê²½ê³ :</strong><br>';
                debugText += 'attendanceConfigê°€ ì—†ìŠµë‹ˆë‹¤!<br>';
                debugText += 'ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì„¤ì •ì„ ì €ì¥í•´ì£¼ì„¸ìš”.<br>';
            }
            
            debugText += '<br><strong>ì•¡ì…˜:</strong><br>';
            debugText += 'â€¢ ğŸ” ì§„ë‹¨ ë²„íŠ¼ìœ¼ë¡œ ì‹¤ì‹œê°„ ì²´í¬<br>';
            debugText += 'â€¢ ğŸ”„ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ì™„ì „ ë¦¬ì…‹<br>';
            
            debugDetails.innerHTML = debugText;
        }

        // í˜ì´ì§€ ë¡œë“œ í›„ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ ì¶”ê°€
        setTimeout(addManualRefreshButton, 1000);

        // ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬
        window.addEventListener('error', (event) => {
            console.error('ì „ì—­ ì˜¤ë¥˜:', event.error);
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('ì²˜ë¦¬ë˜ì§€ ì•Šì€ Promise ê±°ë¶€:', event.reason);
        });
        
    </script>
</body>
</html>
